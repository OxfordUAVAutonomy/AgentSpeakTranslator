strm << "/* in the event-queue-less version, we have potentially two events:\n";
strm << " * 1) an event that needs to be completed, this one will always be given\n";
strm << " *    preference, if set\n";
strm << " * 2) a deferred event, this one will be used, if no event to complete\n";
strm << " *    is set\n";
strm << " */\n";
strm << "static bool rtc_event_set;\n";
strm << "static eventt rtc_event;\n";
strm << "static bool deferred_event_set;\n";
strm << "static eventt deferred_event;\n";
strm << "\n";
strm << "/* initialise the events, there's not much to do here... */\n";
strm << "static void init_events(void)\n";
strm << "{\n";
strm << "  rtc_event_set = false;\n";
strm << "  deferred_event_set = false;\n";
strm << "}\n";
strm << "\n";
strm << "/* indicate whether another event can be generated */\n";
strm << "bool can_add_event(void)\n";
strm << "{\n";
strm << "  return !rtc_event_set;\n";
strm << "}\n";
strm << "\n";
strm << "/* add deferred event */\n";
strm << "static bool add_event_new_focus(eventt event)\n";
strm << "{\n";
strm << "  if (!deferred_event_set)\n";
strm << "  {\n";
strm << "    deferred_event = event;\n";
strm << "    deferred_event_set = true;\n";
strm << "    return true;\n";
strm << "  }\n";
strm << "  // TODO: This should not happen\n";
strm << "  return false;\n";
strm << "}\n";
strm << "\n";
strm << "/* add event to complete */\n";
strm << "static bool add_event_to_complete(eventt event)\n";
strm << "{\n";
strm << "  if (!rtc_event_set)\n";
strm << "  {\n";
strm << "    rtc_event = event;\n";
strm << "    rtc_event_set = true;\n";
strm << "    return true;\n";
strm << "  }\n";
strm << "  // TODO: This should not happen\n";
strm << "  return false;  \n";
strm << "}\n";
strm << "\n";
strm << "/* without an event queue, we handle external events immediately, as they are supposed\n";
strm << "   to be only added when can_add_event() returns true, i.e., no event_to_complete is set */\n";
strm << "static bool add_external_event(eventt event)\n";
strm << "{\n";
strm << "  return add_event_to_complete(event);\n";
strm << "}\n";
strm << "\n";
strm << "/* get next event: event_to_complete is given preference over deferred_event */\n";
strm << "static eventt get_next_event(void)\n";
strm << "{\n";
strm << "  eventt event = { NONE };\n";
strm << "  if (rtc_event_set) \n";
strm << "  {\n";
strm << "    event = rtc_event;\n";
strm << "    rtc_event_set = false;\n";
strm << "  }\n";
strm << "  else if (deferred_event_set)\n";
strm << "  {\n";
strm << "    event = deferred_event;\n";
strm << "    deferred_event_set = false;\n";
strm << "  }\n";
strm << "  return event;\n";
strm << "}\n";
strm << "\n";
